!function(){var e=Gmaps.build("Google",{markers:{clusterer:{minimumClusterSize:4,enableRetinaIcons:!0,styles:[{textSize:12,textColor:"#FFF",url:"/images/directory/map-cluster-1.png",height:28,width:28},{textSize:15,textColor:"#FFF",url:"/images/directory/map-cluster-2.png",height:36,width:36}]}}}),a=$("meta[name=mapOptions]").attr("content"),t=$("meta[name=locations]").attr("content"),n=$("meta[name=categories]").attr("content"),r=[],o=($(".list a"),{lat:49.282974,lng:-123.059724}),i=new google.maps.LatLng(o.lat,o.lng),s=$(".js-menu > ul"),c=$(".cards"),l={url:"images/directory/map-pin.png",width:33,height:39},p=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},m=function(e){var a="";if(a+="<h2 class='name'>"+e.name+"</h2>",a+="<div class='address'>"+e.address+"</div>","undefined"!=typeof e.website&&null!==e.website){var t=e.website.length<=36?e.website:"Go to website";a+="<div class='view'><a href='"+p(e.website)+"' target='_blank'>"+t+"</a></div>"}if("undefined"!=typeof e.twitter&&null!==e.twitter){{$("<a />",{"class":"fa fa-twitter-square",href:"http://twitter.com/"+e.twitter})}a+="<a href='http://twitter.com/"+e.twitter+"' class='fa fa-twitter-square'></a>"}if("undefined"!=typeof e.facebook&&null!==e.facebook){{$("<a />",{"class":"fa fa-facebook-square",href:e.facebook})}a+="<a href='"+e.facebook+"' class='fa fa-facebook-square'></a>"}if("undefined"!=typeof e.instagram&&null!==e.instagram){{$("<a />",{"class":"fa fa-instagram",href:e.instagram})}a+="<a href='"+e.instagram+"' class='fa fa-instagram'></a>"}e.infowindow="<div class='map-marker'>"+a+"</div>",e.picture=l,e.lat&&e.lng&&r.push(e)},f=function(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},d=function(){e.buildMap(a,function(){e.map.centerOn(i),e.getMap().setZoom(14)})},g=function(a){e.getMap().setZoom(a!=o.lat?16:14)},u=function(a){var t=a.coords,n=new google.maps.LatLng(t.latitude,t.longitude);e.map.centerOn(n),g(e.getMap().getCenter().k)},h=function(e){var a=f(e.name),t=$("<div />",{"class":"card"}),n=$("<a />",{html:e.name,"class":a}),r=$("<div />",{"class":"card-header"}).append(n),o=$("<span />",{"class":"fa fa-phone"}),i=$("<a />",{html:e.phone,href:"callto:"+e.phone,"class":"card-phone"}).prepend(o),s=$("<span />",{"class":"fa fa-map-marker"}),l=$("<div />",{"class":"card-copy",html:e.address}).prepend(s).append(i);t.append(r).append(l),c.append(t)},v=function(a){var t=e.addMarkers(a);_.each(a,function(a,n){a.marker=t[n],h(a);var r=f(a.name);$(document).on("click","."+r,function(t){t.preventDefault(),e.getMap().setZoom(18),a.marker.setMap(e.getMap()),a.marker.panTo(),google.maps.event.trigger(a.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),e.bounds.extendWith(t)},w=function(){e.removeMarkers(),c.html("")},k=function(e){var a=$("<a />",{html:e.name,href:"#"}),t=$("<li />").append(a);s.append(t),a.on("click",function(){"All"==e.name?M():y(e.name),$(".js-menu-screen").trigger("click")})},b=function(){_.each(n,k)},M=function(){w(r),O(r),e.map.centerOn(i),e.getMap().setZoom(16),$("h1 span").html(" : All")},y=function(a){var t=_.filter(r,function(e){return"undefined"!=typeof e.category&&null!==e.category?e.category.name==a:void 0});w(r),O(t),e.map.centerOn(i),e.getMap().setZoom(16),$("h1 span").html(" : "+a)},O=function(t){e.buildMap(a,function(){v(t)})};a=JSON.parse(a),t=JSON.parse(t),n=JSON.parse(n),a.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,d(),navigator.geolocation.getCurrentPosition(u),_.each(t,m),O(r),google.maps.event.addDomListener(window,"resize",function(){var a=e.getMap().getCenter();google.maps.event.trigger(e.getMap(),"resize"),e.getMap().setCenter(a)}),b()}();