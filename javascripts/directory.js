!function(){var e=Gmaps.build("Google"),n=$("meta[name=mapOptions]").attr("content"),a=$("meta[name=locations]").attr("content"),t=$("meta[name=categories]").attr("content"),o=[],r=($(".list a"),{lat:49.282982,lng:-123.056554}),i=new google.maps.LatLng(r.lat,r.lng),c=$(".js-menu > ul"),s=$(".cards"),p={url:"images/directory/map-pin.png",width:33,height:39},d=function(e){var n="";n+="<h2 class='name'>"+e.name+"</h2>",n+="<div class='address'>"+e.address+"</div>",n+="<div class='view'><a href='"+e.website+"' target='_blank'>Go to website</a></div>",e.infowindow="<div class='map-marker'>"+n+"</div>",e.picture=p,e.lat&&e.lng&&o.push(e)},l=function(){e.buildMap(n,function(){e.map.centerOn(i),e.getMap().setZoom(14)})},g=function(n){e.getMap().setZoom(n!=r.lat?16:14)},m=function(n){var a=n.coords,t=new google.maps.LatLng(a.latitude,a.longitude);e.map.centerOn(t),g(e.getMap().getCenter().k)},u=function(e){var n=$("<div />",{"class":"card"}),a=$("<div />",{"class":"card-header",html:e.name}),t=$("<p />",{html:e.phone}),o=$("<div />",{"class":"card-copy",html:e.address}).append(t);cardImage.append(image),n.append(a).append(o),s.append(n)},f=function(n){var a=e.addMarkers(n);_.each(n,function(e,n){e.marker=a[n],u(e)}),e.bounds.extendWith(a)},v=function(){e.removeMarkers(),s.html("")},h=function(e){var n=$("<a />",{html:e.name,href:"#"}),a=$("<li />").append(n);c.append(a),n.on("click",function(){w(e.name),$(".js-menu-screen").trigger("click")})},M=function(){_.each(t,h)},w=function(n){var a=_.filter(o,function(e){return"undefined"!=typeof e.category&&null!==e.category?e.category.name==n:void 0});v(o),k(a),e.map.centerOn(i),e.getMap().setZoom(16)},k=function(a){e.buildMap(n,function(){f(a)})};n=JSON.parse(n),a=JSON.parse(a),t=JSON.parse(t),n.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,l(),navigator.geolocation.getCurrentPosition(m),_.each(a,d),k(o),google.maps.event.addDomListener(window,"resize",function(){var n=e.getMap().getCenter();google.maps.event.trigger(e.getMap(),"resize"),e.getMap().setCenter(n)}),M()}();