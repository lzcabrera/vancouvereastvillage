!function(){var e,t=Gmaps.build("Google",{markers:{clusterer:{minimumClusterSize:7,enableRetinaIcons:!0,styles:[{textSize:12,textColor:"#FFF",url:"images/directory/map-cluster-1.png",height:28,width:28},{textSize:15,textColor:"#FFF",url:"images/directory/map-cluster-2.png",height:36,width:36}]}}}),a=$("meta[name=mapOptions]").attr("content"),n=$("meta[name=locations]").attr("content"),r=$("meta[name=categories]").attr("content"),o=[],i=($(".list a"),{lat:49.282974,lng:-123.059724}),s=new google.maps.LatLng(i.lat,i.lng),c=($(".js-menu > ul"),$(".cards")),l={url:"images/directory/map-pin.png",width:33,height:46},p=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},u=function(e){var t="";if(t+="<h2 class='name'>"+e.name+"</h2>",t+="<div class='address'>"+e.address+"</div>","undefined"!=typeof e.website&&null!==e.website){var a=e.website.length<=33?e.website:"Go to website";t+="<div class='view'><a class='website' href='"+p(e.website)+"' target='_blank'>"+a+"</a></div>"}if("undefined"!=typeof e.twitter&&null!==e.twitter){{$("<a />",{"class":"fa fa-twitter-square",href:"http://twitter.com/"+e.twitter})}t+="<a href='http://twitter.com/"+e.twitter+"' class='fa fa-twitter-square'></a>"}if("undefined"!=typeof e.facebook&&null!==e.facebook){{$("<a />",{"class":"fa fa-facebook-square",href:e.facebook})}t+="<a href='"+e.facebook+"' class='fa fa-facebook-square'></a>"}if("undefined"!=typeof e.instagram&&null!==e.instagram){{$("<a />",{"class":"fa fa-instagram",href:e.instagram})}t+="<a href='"+e.instagram+"' class='fa fa-instagram'></a>"}e.infowindow="<div class='map-marker'>"+t+"</div>",e.picture=l,e.lat&&e.lng&&o.push(e)},f=function(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},m=function(){t.buildMap(a,function(){t.map.centerOn(s),t.getMap().setZoom(14),t.fitMapToBounds()})},g=function(e){t.getMap().setZoom(e!=i.lat?16:14)},d=function(e){var a=e.coords,n=new google.maps.LatLng(a.latitude,a.longitude);t.map.centerOn(n),g(t.getMap().getCenter().k)},h=function(e){var t=f(e.name),a=$("<div />",{"class":"card"}),n=$("<a />",{html:e.name,"class":t}),r=$("<div />",{"class":"card-header"}).append(n),o=$("<span />",{"class":"fa fa-phone"}),i=$("<span />",{"class":"fa fa-map-marker"}),s=$("<div />",{"class":"card-copy",html:e.address}).prepend(i);if("undefined"!=typeof e.phone&&null!==e.phone){var l=$("<a />",{html:e.phone,href:"tel:"+e.phone,"class":"card-phone"}).prepend(o);s.append(l)}a.append(r).append(s),c.append(a)},v=function(e){var a=t.addMarkers(e);_.each(e,function(e,n){e.marker=a[n],h(e);var r=f(e.name);$(document).on("click","."+r,function(a){a.preventDefault(),t.getMap().setZoom(18),e.marker.setMap(t.getMap()),e.marker.panTo(),google.maps.event.trigger(e.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),t.bounds.extendWith(a)},k=function(e){var a=t.addMarkers(e);_.each(e,function(e,n){e.marker=a[n];var r=f(e.name);$(document).on("click","."+r,function(a){a.preventDefault(),t.getMap().setZoom(18),e.marker.setMap(t.getMap()),e.marker.panTo(),google.maps.event.trigger(e.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),t.bounds.extendWith(a)},w=function(){t.removeMarkers(),c.html("")},b=function(){var e=$("ul.categories li a");_.each(e,function(e){$(e).on("click",function(e){var t=$(this),a=t.attr("href"),n=t.next(),r=n.find("li a"),o=$("ul.subcategories");e.preventDefault(),"All"==a?(M(),o.removeClass("show-element"),$(".js-menu-screen").trigger("click")):(O(a),r.length>0?(o.removeClass("show-element"),n.addClass("show-element")):$(".js-menu-screen").trigger("click"))})})},y=function(){var e=$("ul.subcategories li a");_.each(e,function(e){$(e).on("click",function(e){var t=$(this),a=t.attr("href");e.preventDefault(),S(a)})})},M=function(){w(o),Z(o),t.map.centerOn(s),t.getMap().setZoom(16),$("header h2 span").html(" : All")},C=function(e,t){return e==t},O=function(e){var a=_.filter(o,function(t){return"undefined"!=typeof t.category&&null!==t.category?C(e,t.category.name):void 0});w(o),Z(a),t.map.centerOn(s),t.getMap().setZoom(16),$("header h2 span").html(" : "+e)},S=function(e){var a=_.filter(o,function(t){var a=[];return"undefined"!=typeof t.category.subcategory&&null!==t.category.subcategory?(_.each(t.category.subcategory,function(e){a.push(e.name)}),_.include(a,e)):void 0});w(o),Z(a),t.map.centerOn(s),t.getMap().setZoom(16),$("header h2 span").html(" : "+e)},Z=function(e,n){t.buildMap(a,function(){n?k(e):v(e),t.fitMapToBounds()})};a=JSON.parse(a),n=JSON.parse(n),e=_.sortBy(n,function(e){return e.name}),r=JSON.parse(r),a.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,m(),navigator.geolocation.getCurrentPosition(d),_.each(e,u),Z(o,!0),google.maps.event.addDomListener(window,"resize",function(){var e=t.getMap().getCenter();google.maps.event.trigger(t.getMap(),"resize"),t.getMap().setCenter(e)}),b(),y()}();