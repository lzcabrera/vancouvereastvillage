!function(){var e,t=Gmaps.build("Google",{markers:{clusterer:{minimumClusterSize:7,enableRetinaIcons:!0,styles:[{textSize:12,textColor:"#FFF",url:"images/directory/map-cluster-1.png",height:28,width:28},{textSize:15,textColor:"#FFF",url:"images/directory/map-cluster-2.png",height:36,width:36}]}}}),a=$("meta[name=mapOptions]").attr("content"),n=$("meta[name=locations]").attr("content"),r=$("meta[name=categories]").attr("content"),o=[],i=($(".list a"),{lat:49.282974,lng:-123.059724}),s=new google.maps.LatLng(i.lat,i.lng),c=$(".js-menu > ul"),l=$(".cards"),p={url:"images/directory/map-pin.png",width:33,height:39},m=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},f=function(e){var t="";if(t+="<h2 class='name'>"+e.name+"</h2>",t+="<div class='address'>"+e.address+"</div>","undefined"!=typeof e.website&&null!==e.website){var a=e.website.length<=33?e.website:"Go to website";t+="<div class='view'><a class='website' href='"+m(e.website)+"' target='_blank'>"+a+"</a></div>"}if("undefined"!=typeof e.twitter&&null!==e.twitter){{$("<a />",{"class":"fa fa-twitter-square",href:"http://twitter.com/"+e.twitter})}t+="<a href='http://twitter.com/"+e.twitter+"' class='fa fa-twitter-square'></a>"}if("undefined"!=typeof e.facebook&&null!==e.facebook){{$("<a />",{"class":"fa fa-facebook-square",href:e.facebook})}t+="<a href='"+e.facebook+"' class='fa fa-facebook-square'></a>"}if("undefined"!=typeof e.instagram&&null!==e.instagram){{$("<a />",{"class":"fa fa-instagram",href:e.instagram})}t+="<a href='"+e.instagram+"' class='fa fa-instagram'></a>"}e.infowindow="<div class='map-marker'>"+t+"</div>",e.picture=p,e.lat&&e.lng&&o.push(e)},d=function(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},g=function(){t.buildMap(a,function(){t.map.centerOn(s),t.getMap().setZoom(14)})},u=function(e){t.getMap().setZoom(e!=i.lat?16:14)},h=function(e){var a=e.coords,n=new google.maps.LatLng(a.latitude,a.longitude);t.map.centerOn(n),u(t.getMap().getCenter().k)},v=function(e){var t=d(e.name),a=$("<div />",{"class":"card"}),n=$("<a />",{html:e.name,"class":t}),r=$("<div />",{"class":"card-header"}).append(n),o=$("<span />",{"class":"fa fa-phone"}),i=$("<span />",{"class":"fa fa-map-marker"}),s=$("<div />",{"class":"card-copy",html:e.address}).prepend(i);if("undefined"!=typeof e.phone&&null!==e.phone){var c=$("<a />",{html:e.phone,href:"tel:"+e.phone,"class":"card-phone"}).prepend(o);s.append(c)}a.append(r).append(s),l.append(a)},k=function(e){var a=t.addMarkers(e);_.each(e,function(e,n){e.marker=a[n],v(e);var r=d(e.name);$(document).on("click","."+r,function(a){a.preventDefault(),t.getMap().setZoom(18),e.marker.setMap(t.getMap()),e.marker.panTo(),google.maps.event.trigger(e.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),t.bounds.extendWith(a)},w=function(e){var a=t.addMarkers(e);_.each(e,function(e,n){e.marker=a[n];var r=d(e.name);$(document).on("click","."+r,function(a){a.preventDefault(),t.getMap().setZoom(18),e.marker.setMap(t.getMap()),e.marker.panTo(),google.maps.event.trigger(e.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),t.bounds.extendWith(a)},b=function(){t.removeMarkers(),l.html("")},M=function(e){var t=$("<a />",{html:e.name,href:"#"}),a=$("<li />").append(t);c.append(a),t.on("click",function(){"All"==e.name?O():S(e.name),$(".js-menu-screen").trigger("click")})},y=function(){_.each(r,M)},O=function(){b(o),C(o),t.map.centerOn(s),t.getMap().setZoom(16),$("header h2 span").html(" : All")},S=function(e){var a=_.filter(o,function(t){return"undefined"!=typeof t.category&&null!==t.category?t.category.name==e:void 0});b(o),C(a),t.map.centerOn(s),t.getMap().setZoom(16),$("header h2 span").html(" : "+e)},C=function(e,n){t.buildMap(a,function(){n?w(e):k(e)})};a=JSON.parse(a),n=JSON.parse(n),e=_.sortBy(n,function(e){return e.name}),r=JSON.parse(r),a.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,g(),navigator.geolocation.getCurrentPosition(h),_.each(e,f),C(o,!0),google.maps.event.addDomListener(window,"resize",function(){var e=t.getMap().getCenter();google.maps.event.trigger(t.getMap(),"resize"),t.getMap().setCenter(e)}),y()}();