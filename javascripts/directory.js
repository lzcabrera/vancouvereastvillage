!function(){var e=Gmaps.build("Google"),t=$("meta[name=mapOptions]").attr("content"),n=$("meta[name=locations]").attr("content"),a=$("meta[name=categories]").attr("content"),o=[],i=($(".list a"),{lat:49.282982,lng:-123.056554}),r=new google.maps.LatLng(i.lat,i.lng),s=$(".js-menu > ul"),c={url:"../images/directory/map-pin.png",width:33,height:39},g=function(e){var t="";t+="<h2 class='name'>"+e.name+"</h2>",t+="<div class='address'>"+e.address+"</div>",t+="<div class='view'><a href='"+e.website+"' target='_blank'>Go to website</a></div>",e.infowindow="<div class='map-marker'>"+t+"</div>",e.picture=c,e.lat&&e.lng&&o.push(e)},l=function(){e.buildMap(t,function(){e.map.centerOn(r),e.getMap().setZoom(14)})},m=function(t){e.getMap().setZoom(t!=i.lat?16:14)},p=function(t){var n=t.coords,a=new google.maps.LatLng(n.latitude,n.longitude);e.map.centerOn(a),m(e.getMap().getCenter().k)},u=function(t){var n=e.addMarkers(t);_.each(t,function(e,t){e.marker=n[t]}),e.bounds.extendWith(n)},d=function(){e.removeMarkers()},f=function(e){var t=$("<a />",{html:e.name,href:"#"}),n=$("<li />").append(t);s.append(n),t.on("click",function(){h(e.name),$(".js-menu-screen").trigger("click")})},v=function(){_.each(a,f)},h=function(t){var n=_.filter(o,function(e){return"undefined"!=typeof e.category&&null!==e.category?e.category.name==t:void 0});d(o),M(n),e.map.centerOn(r),e.getMap().setZoom(16)},M=function(n){e.buildMap(t,function(){u(n)})};t=JSON.parse(t),n=JSON.parse(n),a=JSON.parse(a),t.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,l(),navigator.geolocation.getCurrentPosition(p),_.each(n,g),M(o),google.maps.event.addDomListener(window,"resize",function(){var t=e.getMap().getCenter();google.maps.event.trigger(e.getMap(),"resize"),e.getMap().setCenter(t)}),v()}();