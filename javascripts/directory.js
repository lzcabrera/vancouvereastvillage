!function(){var e=Gmaps.build("Google"),t=$("meta[name=mapOptions]").attr("content"),n=$("meta[name=locations]").attr("content"),a=$("meta[name=categories]").attr("content"),o=[],r=($(".list a"),{lat:49.282974,lng:-123.059724}),i=new google.maps.LatLng(r.lat,r.lng),s=$(".js-menu > ul"),c=$(".cards"),p={url:"images/directory/map-pin.png",width:33,height:39},l=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},m=function(e){var t="";if(t+="<h2 class='name'>"+e.name+"</h2>",t+="<div class='address'>"+e.address+"</div>","undefined"!=typeof e.website&&null!==e.website){var n=e.website.length<=36?e.website:"Go to website";t+="<div class='view'><a href='"+l(e.website)+"' target='_blank'>"+n+"</a></div>"}e.infowindow="<div class='map-marker'>"+t+"</div>",e.picture=p,e.lat&&e.lng&&o.push(e)},d=function(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},g=function(){e.buildMap(t,function(){e.map.centerOn(i),e.getMap().setZoom(14)})},u=function(t){e.getMap().setZoom(t!=r.lat?16:14)},f=function(t){var n=t.coords,a=new google.maps.LatLng(n.latitude,n.longitude);e.map.centerOn(a),u(e.getMap().getCenter().k)},h=function(e){var t=d(e.name),n=$("<div />",{"class":"card"}),a=$("<a />",{html:e.name,"class":t}),o=$("<div />",{"class":"card-header"}).append(a),r=$("<span />",{"class":"fa fa-phone-square"}),i=$("<a />",{html:e.phone,href:"callto:"+e.phone,"class":"card-phone"}).prepend(r),s=$("<div />",{"class":"card-copy",html:e.address}).append(i);n.append(o).append(s),c.append(n)},v=function(t){var n=e.addMarkers(t);_.each(t,function(t,a){t.marker=n[a],h(t);var o=d(t.name);$(document).on("click","."+o,function(n){n.preventDefault(),e.getMap().setZoom(18),t.marker.setMap(e.getMap()),t.marker.panTo(),google.maps.event.trigger(t.marker.getServiceObject(),"click"),$("html, body").animate({scrollTop:0},"slow")})}),e.bounds.extendWith(n)},M=function(){e.removeMarkers(),c.html("")},w=function(e){var t=$("<a />",{html:e.name,href:"#"}),n=$("<li />").append(t);s.append(n),t.on("click",function(){"All"==e.name?k():O(e.name),$(".js-menu-screen").trigger("click")})},b=function(){_.each(a,w)},k=function(){M(o),y(o),e.map.centerOn(i),e.getMap().setZoom(16),$("h1 span").html(" : All")},O=function(t){var n=_.filter(o,function(e){return"undefined"!=typeof e.category&&null!==e.category?e.category.name==t:void 0});M(o),y(n),e.map.centerOn(i),e.getMap().setZoom(16),$("h1 span").html(" : "+t)},y=function(n){e.buildMap(t,function(){v(n)})};t=JSON.parse(t),n=JSON.parse(n),a=JSON.parse(a),t.provider.zoomControlOptions=google.maps.ZoomControlStyle.SMALL,g(),navigator.geolocation.getCurrentPosition(f),_.each(n,m),y(o),google.maps.event.addDomListener(window,"resize",function(){var t=e.getMap().getCenter();google.maps.event.trigger(e.getMap(),"resize"),e.getMap().setCenter(t)}),b()}();